{"pageProps":{"note":{"id":"upmbvixmnzovjmnp9whjagp","title":"2022-05-24","desc":"","updated":1653411757661,"created":1653388129217,"traitIds":["journalNote"],"custom":{},"fname":"daily.journal.2022.05.24","type":"note","vault":{"fsPath":"vault"},"contentHash":"9956de644e11bb6295fec8795d17fca2","links":[{"type":"wiki","from":{"fname":"daily.journal.2022.05.24","id":"upmbvixmnzovjmnp9whjagp","vaultName":"vault"},"value":"user.nrwl/next","alias":"@nrwl/next","position":{"start":{"line":193,"column":183,"offset":10529},"end":{"line":193,"column":193,"offset":10539},"indent":[]},"xvault":false,"to":{"fname":"user.nrwl/next"}},{"type":"wiki","from":{"fname":"daily.journal.2022.05.24","id":"upmbvixmnzovjmnp9whjagp","vaultName":"vault"},"value":"user.nrwl/next","alias":"@nrwl/next","position":{"start":{"line":198,"column":1,"offset":10651},"end":{"line":198,"column":11,"offset":10661},"indent":[]},"xvault":false,"to":{"fname":"user.nrwl/next"}}],"anchors":{"1-created-stackbit-exampleswith-contentful":{"type":"header","text":"1. created stackbit-examples/with-contentful","value":"1-created-stackbit-exampleswith-contentful","line":10,"column":0,"depth":2},"2-discussion-w-simon":{"type":"header","text":"2. Discussion w/ Simon","value":"2-discussion-w-simon","line":22,"column":0,"depth":2},"aaron-r-miller--637-am":{"type":"header","text":"Aaron R Miller  6:37 AM","value":"aaron-r-miller--637-am","line":24,"column":0,"depth":3},"simon--646-am":{"type":"header","text":"Simon  6:46 AM","value":"simon--646-am","line":28,"column":0,"depth":3},"aaron-r-miller--653-am":{"type":"header","text":"Aaron R Miller  6:53 AM","value":"aaron-r-miller--653-am","line":33,"column":0,"depth":3},"simon--714-am":{"type":"header","text":"Simon  7:14 AM","value":"simon--714-am","line":110,"column":0,"depth":3},"aaron-r-miller--714-am":{"type":"header","text":"Aaron R Miller  7:14 AM","value":"aaron-r-miller--714-am","line":114,"column":0,"depth":3},"simon--714-am-1":{"type":"header","text":"Simon  7:14 AM","value":"simon--714-am-1","line":118,"column":0,"depth":3},"simon--717-am":{"type":"header","text":"Simon  7:17 AM","value":"simon--717-am","line":127,"column":0,"depth":3},"aaron-r-miller--726-am":{"type":"header","text":"Aaron R Miller  7:26 AM","value":"aaron-r-miller--726-am","line":132,"column":0,"depth":3},"simon--747-am":{"type":"header","text":"Simon  7:47 AM","value":"simon--747-am","line":139,"column":0,"depth":3},"simon--752-am":{"type":"header","text":"Simon  7:52 AM","value":"simon--752-am","line":161,"column":0,"depth":3},"aaron-r-miller--801-am":{"type":"header","text":"Aaron R Miller  8:01 AM","value":"aaron-r-miller--801-am","line":167,"column":0,"depth":3},"simon--805-am":{"type":"header","text":"Simon  8:05 AM","value":"simon--805-am","line":179,"column":0,"depth":3},"aaron-r-miller--806-am":{"type":"header","text":"Aaron R Miller  8:06 AM","value":"aaron-r-miller--806-am","line":184,"column":0,"depth":3},"simon--806-am":{"type":"header","text":"Simon  8:06 AM","value":"simon--806-am","line":188,"column":0,"depth":3},"aaron-r-miller--809-am":{"type":"header","text":"Aaron R Miller  8:09 AM","value":"aaron-r-miller--809-am","line":199,"column":0,"depth":3},"simon--811-am":{"type":"header","text":"Simon  8:11 AM","value":"simon--811-am","line":213,"column":0,"depth":3},"aaron-r-miller--812-am":{"type":"header","text":"Aaron R Miller  8:12 AM","value":"aaron-r-miller--812-am","line":217,"column":0,"depth":3},"simon--812-am":{"type":"header","text":"Simon  8:12 AM","value":"simon--812-am","line":221,"column":0,"depth":3},"aaron-r-miller--815-am":{"type":"header","text":"Aaron R Miller  8:15 AM","value":"aaron-r-miller--815-am","line":227,"column":0,"depth":3},"simon--816-am":{"type":"header","text":"Simon  8:16 AM","value":"simon--816-am","line":231,"column":0,"depth":3},"aaron-r-miller--816-am":{"type":"header","text":"Aaron R Miller  8:16 AM","value":"aaron-r-miller--816-am","line":235,"column":0,"depth":3},"simon--816-am-1":{"type":"header","text":"Simon  8:16 AM","value":"simon--816-am-1","line":239,"column":0,"depth":3},"aaron-r-miller--816-am-1":{"type":"header","text":"Aaron R Miller  8:16 AM","value":"aaron-r-miller--816-am-1","line":243,"column":0,"depth":3},"simon--818-am":{"type":"header","text":"Simon  8:18 AM","value":"simon--818-am","line":247,"column":0,"depth":3},"aaron-r-miller--818-am":{"type":"header","text":"Aaron R Miller  8:18 AM","value":"aaron-r-miller--818-am","line":253,"column":0,"depth":3},"simon--818-am-1":{"type":"header","text":"Simon  8:18 AM","value":"simon--818-am-1","line":257,"column":0,"depth":3},"aaron-r-miller--819-am":{"type":"header","text":"Aaron R Miller  8:19 AM","value":"aaron-r-miller--819-am","line":261,"column":0,"depth":3},"simon--819-am":{"type":"header","text":"Simon  8:19 AM","value":"simon--819-am","line":265,"column":0,"depth":3},"aaron-r-miller--819-am-1":{"type":"header","text":"Aaron R Miller  8:19 AM","value":"aaron-r-miller--819-am-1","line":269,"column":0,"depth":3},"simon--819-am-1":{"type":"header","text":"Simon  8:19 AM","value":"simon--819-am-1","line":275,"column":0,"depth":3},"aaron-r-miller--820-am":{"type":"header","text":"Aaron R Miller  8:20 AM","value":"aaron-r-miller--820-am","line":281,"column":0,"depth":3},"simon--821-am":{"type":"header","text":"Simon  8:21 AM","value":"simon--821-am","line":287,"column":0,"depth":3},"aaron-r-miller--823-am":{"type":"header","text":"Aaron R Miller  8:23 AM","value":"aaron-r-miller--823-am","line":298,"column":0,"depth":3},"simon--826-am":{"type":"header","text":"Simon  8:26 AM","value":"simon--826-am","line":304,"column":0,"depth":3},"aaron-r-miller--828-am":{"type":"header","text":"Aaron R Miller  8:28 AM","value":"aaron-r-miller--828-am","line":308,"column":0,"depth":3},"starter-nextjs-contentful-theme":{"type":"header","text":"starter-nextjs-contentful-theme","value":"starter-nextjs-contentful-theme","line":314,"column":0,"depth":2},"annotation-errors":{"type":"header","text":"Annotation Errors","value":"annotation-errors","line":316,"column":0,"depth":2},"mdx-updates":{"type":"header","text":"MDX Updates","value":"mdx-updates","line":318,"column":0,"depth":2}},"children":[],"parent":"rusgp2b9zse8au65qii1azk","data":{}},"body":"<h1 id=\"2022-05-24\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#2022-05-24\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>2022-05-24</h1>\n<h2 id=\"1-created-stackbit-exampleswith-contentful\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#1-created-stackbit-exampleswith-contentful\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>1. created <code>stackbit-examples/with-contentful</code></h2>\n<pre class=\"language-env\"><code class=\"language-env\">CONTENTFUL_ACCESS_TOKEN = \"CFPAT-kzf9FJ09TlPl9eM64NqJM5a2TwnHJyQFT-FNinHlGEw\" \n\nCONTENTFUL_SPACE_ID = \"630tuj81l5gj\"\n\nCONTENTFUL_PREVIEW_TOKEN = \"kBQDwZ6UBdMROip2x-Qq22S-3Kag48zJRuXY84G1fuQ\"\n\nCONTENTFUL_DELIVERY_TOKEN = \"Gxqq3aUvqTXG9cHfiK5qA8XDmfRt7ejuvvLKmUUPVtw\"\n</code></pre>\n<h2 id=\"2-discussion-w-simon\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#2-discussion-w-simon\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>2. Discussion w/ Simon</h2>\n<h3 id=\"aaron-r-miller--637-am\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#aaron-r-miller--637-am\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Aaron R Miller  6:37 AM</h3>\n<p>So do I understand correctly then, that the implication of this is that fetching data on a per-page basis with cache eviction is out of the question? It must all be loaded upfront prior to request? (presumably, so all the transform functions will correctly resolve synchronously).</p>\n<h3 id=\"simon--646-am\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#simon--646-am\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Simon  6:46 AM</h3>\n<p>Sourcebit always loads upfront all the data and caches it. In dev mode, it watches for changes in data and updates that cache.\nYes, then functions in next.js can decide how to filter and reduce the data per page.</p>\n<h3 id=\"aaron-r-miller--653-am\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#aaron-r-miller--653-am\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Aaron R Miller  6:53 AM</h3>\n<p>I was thinking of putting a prototype together based on serviceworker cache, and I'm wondering if this would be feasible or not given Sourcebit requirements. Does the entire dataset need to be available for sourcebit plugins to be sound, or can it to be lazy-loaded on-demand as well, in theory? Or in other words, can we safely assume each loaded model will have a deterministic/unique uri at runtime?</p>\n<p>Google DevelopersGoogle Developers\nCaching Files with Service Worker  |  Web  |  Google Developers (16 kB)\n<a href=\"https://developers.google.com/web/ilt/pwa/caching-files-with-service-worker\">https://developers.google.com/web/ilt/pwa/caching-files-with-service-worker</a></p>\n<p>Simon  6:54 AM\nNot sure I understand the full picture\n6:56\nmaybe, lets start from, what are you trying to achieve?</p>\n<p>Aaron R Miller  7:01 AM\nThis is probably a \"for later\" task, but it's something I've been keeping in the back of my mind (related to the thread-safety problem I've been harping about).\nEssentially it would be \"pull-based\" instead of \"push-based\" like it is now. Request /about from service worker and it returns the cached model if it exists, otherwise, load data -> transform -> cache -> return.</p>\n<p>Simon  7:02 AM\nwhere would it happen? on client side, on server side?\n7:03\nhow does the cache knows if the data was updated?\n7:04\nalso, why do you think that right now the data is \"push-based\"?</p>\n<p>Aaron R Miller  7:05 AM\nclientside I would think. Cache is dumb according to spec.\nAn origin can have multiple, named Cache objects. You are responsible for implementing how your script (e.g. in a ServiceWorker) handles Cache updates. Items in a Cache do not get updated unless explicitly requested; they don't expire unless deleted. Use CacheStorage.open() to open a specific named Cache object and then call any of the Cache methods to maintain the Cache.\nIt is push based in the sense that all the data has to be loaded then \"pushed\" into the cache (for lack of a better term)</p>\n<p>Simon  7:06 AM\nactually I think the data is being \"pulled\" rather pushed\n7:08\nFor example, sourcebit listens to content updates in CMS, and once content is updated it \"pulls\" the updated content and updates its internal cache on the server. Which brings to another point is that the cache has to be on the server, not on the client because you are risking that every user will see something different.\nThen sourcebit notifies the client of the updated data and once again, client \"pulls\" the data by re-fetching the props of the current page and triggering getStaticProps. (edited)</p>\n<p>Aaron R Miller  7:09 AM\nIt is, from a network perspective. I think a more correct distinction would be to say \"ondemand\" vs not. I am referring specifically to how resources are loaded into the cache</p>\n<p>Simon  7:10 AM\nSo when you say \"Items in a Cache do not get updated unless explicitly requested\"\nMy question is who requests these changes? Which entity is responsible to watch for updates and notify the cache?</p>\n<p>Aaron R Miller  7:10 AM\nSourcebit plugin</p>\n<p>Simon  7:11 AM\nThis is what is happening today. So what is the difference?</p>\n<p>Aaron R Miller  7:12 AM\nWhy then does fetch need to run in request? If not to load the data and fill all the cache ahead of time...</p>\n<p>Simon  7:13 AM\nthe fetch doesn't run in request</p>\n<p>Aaron R Miller  7:13 AM\nI mean the redirect block</p>\n<p>Simon  7:13 AM\nthe fetch is run only once, one next.js starts</p>\n<p>Aaron R Miller  7:13 AM\nright, exactly</p>\n<p>Simon  7:13 AM\nlook at the code :slightly_smiling_face:\nit doesn't run when the redirect is called</p>\n<p>Aaron R Miller  7:14 AM\nredirects: async () => {\n// wait for sourcebit to generate sourecbit-nextjs-cache file before proceeding to load tailwind config\nif (!devServerStarted) {\ndevServerStarted = true;\nawait sourcebit.fetch(sourcebitConfig);\n}\nreturn [];\n},</p>\n<h3 id=\"simon--714-am\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#simon--714-am\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Simon  7:14 AM</h3>\n<p>it is using the blocking nature of next.js configuration in relations to redirect setup code to ensure that sourcebit.fetch finishes before next.js can continue starting the server</p>\n<h3 id=\"aaron-r-miller--714-am\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#aaron-r-miller--714-am\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Aaron R Miller  7:14 AM</h3>\n<p>This code?</p>\n<h3 id=\"simon--714-am-1\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#simon--714-am-1\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Simon  7:14 AM</h3>\n<p>yes\n7:15\nyou see, it is called only once, when next.js starts, it is never called when you request a page</p>\n<p>Aaron R Miller  7:16 AM\nRight. That would be the difference. Lazy loaded vs loaded all up front.</p>\n<h3 id=\"simon--717-am\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#simon--717-am\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Simon  7:17 AM</h3>\n<p>I see, so you are saying lets load all the data when any page is requested for the first time.\nBut why? If we can preload all the data ahead of time and simplify the process.</p>\n<h3 id=\"aaron-r-miller--726-am\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#aaron-r-miller--726-am\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Aaron R Miller  7:26 AM</h3>\n<p>Because all that data needs to be sent over the wire in one giant blob of JSON[1]. This way only the data needed for the page would be sent across the wire. What happens in the case of a 10,000 page site? The main benefit I'm after is multiple named caches can be used so I can finally build my themes in parallel. Stackbit stuff is one of the few remaining holdouts I have with \"things I need to disable parallel builds for\". Using the serviceworker cache was my idea to get this functionality for free, but it seems like it's probably going to be more trouble than its worth, from what you're saying\n[1] Unless I am mistaken on how nextjs shares code with getStaticProps\n7:30\nAnd I bet were I to go down this road myself, I would end up on the same conclusion you did</p>\n<h3 id=\"simon--747-am\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#simon--747-am\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Simon  7:47 AM</h3>\n<p>In the case of 10,000 pages site, without doing what we are doing today you will end up with longer build times and you will end up fetching more data than you actually need to.\nAssume a page has a reference to 10 blog posts. And every blog post has a reference to 3 authors:\npage\npost 1\nco-author 1\nco-author 2\nco-author 3\npost 2\n...\n... post 10\nHere, I showed you the tree of the resolved objects, but in CMS they are stored as separate objects and linked by references with IDs.\nSo, if you don't load all the data beforehand and lazy load it on demand then you are introducing 3 problems:\nLong time waterfall requests:\nWhen you try to build or load the page in the browser, your getStaticProps function would need to first fetch the page object. Then it will need to look into the \"posts\" array, and use their IDs to fetch the actual post, then for every post, you will need to take the IDs of the authors and fetch their data, for example to render their names besides the posts. So now have 3-level deep waterfall with serial requests. And that process happens for every single page. Except these who have their data cached, but it is enough that every page has a post that is not used among other pages, you will have to wait anyway.\nFetching same data multiple times:\nNow assume you are building all 10,000 pages in parallel. This means that while page 1 fetches its 10 posts, another page might show a subset of these posts, so for that page, your getStacicProps method will request the same objects. So you will end up requesting the same object twice instead of preloading it once and storing it in the cache.\nNow, of course you can create really smart cache that also manages the state of current requests and if another page requests an object that was already requested, then you can attach the response handler to the running requests. But that is a huge effort for something that is not needed.\nMissing cache for editors using stackbit\nAdditionally, if you have 10,000 pages site. Then while developing that site, or using it within Stackbit, then every editor who opens a page that wasn't opened before, which will happen a lot if you have 10,000 pages, will have to wait for getStaticProps to fetch the needed data. (edited)</p>\n<h3 id=\"simon--752-am\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#simon--752-am\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Simon  7:52 AM</h3>\n<p>build my themes in parallel\nDid you try to run every build within the context of folder with stackbit.yaml?\nI think we already found out that the problem is that when you run your builds it generates cache files in the root folder instead of project folder. (edited)</p>\n<h3 id=\"aaron-r-miller--801-am\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#aaron-r-miller--801-am\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Aaron R Miller  8:01 AM</h3>\n<p><a href=\"https://nextjs.org/docs/basic-features/data-fetching/incremental-static-regeneration\">https://nextjs.org/docs/basic-features/data-fetching/incremental-static-regeneration</a>\nThis page describes how one can scale to millions of pages. :slightly_smiling_face:\nBut in all seriousness, I am seeing now how my proposal would sacrifice performance in the common case of smaller sites, for the sake of an edge case, which is def not what we want.\n1> Did you try to run every build within the context of folder with stackbit.yaml?\nYes, but this is not how nx works, and so I wasn't able to get it to work this way. All build commands are run with CWD of the workspace root. This is needed so that the projects can be statically analyzed for dependency order (it takes care of building dependencies in the correct order)</p>\n<p>nextjs.org\nData Fetching: Incremental Static Regeneration | Next.js\nLearn how to create or update static pages at runtime with Incremental Static Regeneration. (43 kB)\n<a href=\"https://nextjs.org/docs/basic-features/data-fetching/incremental-static-regeneration\">https://nextjs.org/docs/basic-features/data-fetching/incremental-static-regeneration</a></p>\n<h3 id=\"simon--805-am\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#simon--805-am\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Simon  8:05 AM</h3>\n<p>Maybe you can prefix the build command with cd?\nbuild: cd project1 &#x26;&#x26; npm run build</p>\n<h3 id=\"aaron-r-miller--806-am\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#aaron-r-miller--806-am\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Aaron R Miller  8:06 AM</h3>\n<p>I also saw there was some functionality related to namespace but it wasn't clear to me if this was something I could use for this</p>\n<h3 id=\"simon--806-am\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#simon--806-am\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Simon  8:06 AM</h3>\n<p>that sounds wrong that nx doesn't allow you to run the build in the context of a folder\n8:07\nhere, it looks like you can specify cwd for your commands\n<a href=\"https://nx.dev/packages/nx/executors/run-commands\">https://nx.dev/packages/nx/executors/run-commands</a>\nNxNx\nnx:run-commands | Nx\nRun any custom commands with Nx. (43 kB)\n<a href=\"https://nx.dev/packages/nx/executors/run-commands\">https://nx.dev/packages/nx/executors/run-commands</a></p>\n<h3 id=\"aaron-r-miller--809-am\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#aaron-r-miller--809-am\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Aaron R Miller  8:09 AM</h3>\n<p>nx is running the build, not nextjs. nx is a build system for executing tasks. Yes you can run arbitrary shell commands with a different CWD, but this is not the same as running the <a title=\"Private\" href=\"https://wiki.dendron.so/notes/hfyvYGJZQiUwQaaxQO27q.html\" target=\"_blank\" class=\"private\">@nrwl/next (Private)</a>:build generator across multiple projects in parallel\n8:10\n<a href=\"https://nx.dev/packages/next/executors/build\">https://nx.dev/packages/next/executors/build</a></p>\n<p>NxNx\n<a title=\"Private\" href=\"https://wiki.dendron.so/notes/hfyvYGJZQiUwQaaxQO27q.html\" target=\"_blank\" class=\"private\">@nrwl/next (Private)</a>:build | Nx\nBuild a Next.js app. (43 kB)\n<a href=\"https://nx.dev/packages/next/executors/build\">https://nx.dev/packages/next/executors/build</a></p>\n<p>8:10\nVery few options available</p>\n<h3 id=\"simon--811-am\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#simon--811-am\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Simon  8:11 AM</h3>\n<p>it sounds like it just lacks an important option :slightly_smiling_face:</p>\n<h3 id=\"aaron-r-miller--812-am\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#aaron-r-miller--812-am\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Aaron R Miller  8:12 AM</h3>\n<p>aye</p>\n<h3 id=\"simon--812-am\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#simon--812-am\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Simon  8:12 AM</h3>\n<p>or at least it should run next build with cwd of a specific folder\n8:15\nyou can also override the cacheFilePath sourcebit option to set your own paths for the file so it will endup inside the correct dir</p>\n<h3 id=\"aaron-r-miller--815-am\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#aaron-r-miller--815-am\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Aaron R Miller  8:15 AM</h3>\n<p>sourcebit-target-next does not respect this (unless I misunderstood)</p>\n<h3 id=\"simon--816-am\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#simon--816-am\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Simon  8:16 AM</h3>\n<p>why not?</p>\n<h3 id=\"aaron-r-miller--816-am\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#aaron-r-miller--816-am\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Aaron R Miller  8:16 AM</h3>\n<p>It hard-codes its own cache file path based on CWD</p>\n<h3 id=\"simon--816-am-1\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#simon--816-am-1\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Simon  8:16 AM</h3>\n<p>nope, it uses cwd if you don't provide the cacheFilePath</p>\n<h3 id=\"aaron-r-miller--816-am-1\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#aaron-r-miller--816-am-1\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Aaron R Miller  8:16 AM</h3>\n<p>Hmm, my mistake. I will take a second look at that</p>\n<h3 id=\"simon--818-am\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#simon--818-am\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Simon  8:18 AM</h3>\n<p>oh, I think I know what you mean\n8:18\nit uses cacheFilePath to save the data, but the data client doesn't respect that</p>\n<h3 id=\"aaron-r-miller--818-am\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#aaron-r-miller--818-am\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Aaron R Miller  8:18 AM</h3>\n<p>From what I remembered this was the case in sourcebit, but not sourcebit-target-next. I've learned much since then however, so I should probably run through it one more time</p>\n<h3 id=\"simon--818-am-1\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#simon--818-am-1\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Simon  8:18 AM</h3>\n<p>this is a bug in sourcebit-target-next</p>\n<h3 id=\"aaron-r-miller--819-am\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#aaron-r-miller--819-am\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Aaron R Miller  8:19 AM</h3>\n<p>ah yes I was using data client. Byt you're saying there's a way to avoid this?</p>\n<h3 id=\"simon--819-am\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#simon--819-am\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Simon  8:19 AM</h3>\n<p>Now I see what you have tried to do here: <a href=\"https://github.com/stackbit/sourcebit-target-next/pull/17/files\">https://github.com/stackbit/sourcebit-target-next/pull/17/files</a></p>\n<h3 id=\"aaron-r-miller--819-am-1\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#aaron-r-miller--819-am-1\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Aaron R Miller  8:19 AM</h3>\n<p>Indeed!\n8:19\n:smile:</p>\n<h3 id=\"simon--819-am-1\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#simon--819-am-1\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Simon  8:19 AM</h3>\n<p>The problem is that you are sending arbitrary cacheFile\n8:19\nbut it needs to use the option that was passed to sourcebit-target-next</p>\n<h3 id=\"aaron-r-miller--820-am\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#aaron-r-miller--820-am\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Aaron R Miller  8:20 AM</h3>\n<p>yes, excatcly. But my PR does not do this I see\n8:21\nThis can be read from context param, yes?</p>\n<h3 id=\"simon--821-am\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#simon--821-am\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Simon  8:21 AM</h3>\n<p>also passing cacheFile to getData every time is probably not a good idea...\nbetter if it had known how the sourcebit-target-next was configured\nNew\n8:22\nthe data-client has nothing in common with the sourcebit-target-next\nit runs in different process and instantiated separately\n8:22\nso it is a problem</p>\n<h3 id=\"aaron-r-miller--823-am\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#aaron-r-miller--823-am\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Aaron R Miller  8:23 AM</h3>\n<p>yes, ideally it would be an option passed to sourcebitNext (if I remember the name correctly). The function that sets up a nextjs redirect code in sourcebit.\n8:25\nthere woul need to be some kind of way to dynamically specify some env var when calling the process, but not from the ambient environment the process is running in</p>\n<h3 id=\"simon--826-am\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#simon--826-am\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Simon  8:26 AM</h3>\n<p>Maybe sourcebit-target-next can set env variable that data-client can later read. But I don't know if it will work.</p>\n<h3 id=\"aaron-r-miller--828-am\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#aaron-r-miller--828-am\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Aaron R Miller  8:28 AM</h3>\n<p>I will put it on my list of things to consider while tinkering. My bright ideas tend to come randomly and without warning :wink:\n8:30\nthank you for taking the time to explain this all to me! It was very inlighting</p>\n<h2 id=\"starter-nextjs-contentful-theme\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#starter-nextjs-contentful-theme\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>starter-nextjs-contentful-theme</h2>\n<h2 id=\"annotation-errors\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#annotation-errors\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Annotation Errors</h2>\n<h2 id=\"mdx-updates\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#mdx-updates\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>MDX Updates</h2>\n<pre class=\"language-plantuml\"><code class=\"language-plantuml\">@startwbs\n* Rich Text Feature WBS\n** stackbit-sdk (3)\n*** Update api scheman (1)\n*** Update validator rules (1)\n** stackbit-app (5)\n*** Slate editor updates (3)\n**** Slate controlbar plugin (3)\n**** Slate inline renderer (1)\n*** Sidebar updates (1)\n*** Component highlighter integration (1)\n*** Other misc updates (1)\n** Release theme updates (1)\n*** stackbit-examples (1)\n*** starter-nextjs-theme (1)\n*** small-business-nextjs-theme (1)\n*** personal-nextjs-theme (1)\n** Release docs (1)\n@endwbs\n</code></pre>","noteIndex":{"id":"tjo6ofe6jnmhoiu439b1w5m","title":"Root","desc":"","updated":1653388098050,"created":1653388098050,"custom":{"nav_order":0,"permalink":"/"},"fname":"root","type":"note","vault":{"fsPath":"vault"},"contentHash":"751db27904810511db8b169b37266ad0","links":[],"anchors":{"welcome-to-dendron":{"type":"header","text":"Welcome to Dendron","value":"welcome-to-dendron","line":7,"column":0,"depth":1},"lookup":{"type":"header","text":"Lookup","value":"lookup","line":11,"column":0,"depth":2}},"children":["rh9hcb7wtoodm4zbkdng8wd","fhngva5d1pz4yxj3fvhqdmm","zo0dkyv7938yq1gcx8uuziy"],"parent":null,"data":{},"body":"# Welcome to Dendron\n\nThis is the root of your dendron vault. If you decide to publish your entire vault, this will be your landing page. You are free to customize any part of this page except the frontmatter on top.\n\n## Lookup\n\nThis section contains useful links to related resources.\n\n- [Getting Started Guide](https://link.dendron.so/6b25)\n- [Discord](https://link.dendron.so/6b23)\n- [Home Page](https://wiki.dendron.so/)\n- [Github](https://link.dendron.so/6b24)\n- [Developer Docs](https://docs.dendron.so/)\n"},"collectionChildren":null,"customHeadContent":null,"config":{"version":5,"dev":{"enablePreviewV2":true},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":true,"vaultSelectionModeOnCreate":"smart","leaveTrace":false,"bubbleUpCreateNew":true,"fuzzThreshold":0.2}},"randomNote":{},"insertNote":{"initialValue":"templates"},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"copyNoteLink":{}},"workspace":{"vaults":[{"fsPath":"vault"}],"journal":{"dailyDomain":"daily","name":"journal","dateFormat":"y.MM.dd","addBehavior":"childOfDomain"},"scratch":{"name":"scratch","dateFormat":"y.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"task":{"name":"task","dateFormat":"y.MM.dd","addBehavior":"asOwnDomain","statusSymbols":{"":" ","wip":"w","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"prioritySymbols":{"H":"high","M":"medium","L":"low"},"todoIntegration":false,"createTaskSelectionType":"selection2link","taskCompleteStatus":["done","x"]},"graph":{"zoomSpeed":1,"createStub":false},"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"enableUserTags":true,"enableHashTags":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":false,"enableEditorDecorations":true,"maxPreviewsCached":10,"maxNoteLength":204800,"enableFullHierarchyNoteTitle":false,"enableHandlebarTemplates":false,"templateHierarchy":"template"},"preview":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableMermaid":true,"enablePrettyRefs":true,"enableKatex":true,"automaticallyShowPreview":false},"publishing":{"siteUrl":"https://drkstr101.github.io/dendron","enableFMTitle":true,"enableNoteTitleForLink":true,"enableMermaid":true,"enablePrettyRefs":true,"enableKatex":true,"copyAssets":true,"siteHierarchies":["root"],"writeStubs":false,"siteRootDir":"docs","seo":{"title":"drkstr101","description":"Personal Knowledge Space"},"github":{"enableEditLink":true,"editLinkText":"Edit this page on GitHub","editBranch":"main","editViewMode":"tree"},"enableSiteLastModified":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableRandomlyColoredTags":true,"enablePrettyLinks":true,"duplicateNoteBehavior":{"action":"useVault","payload":["vault"]},"enableTaskNotes":true,"siteFaviconPath":"favicon.ico","siteIndex":"root"}}},"__N_SSG":true}