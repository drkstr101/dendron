<h1 id="2022-05-27"><a aria-hidden="true" class="anchor-heading" href="#2022-05-27"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>2022-05-27</h1>
<h2 id="questions"><a aria-hidden="true" class="anchor-heading" href="#questions"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Questions</h2>
<h3 id="1-hot-content-reload-vs-with-remote-data-updates"><a aria-hidden="true" class="anchor-heading" href="#1-hot-content-reload-vs-with-remote-data-updates"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>1. <code>hot-content-reload</code> vs <code>with-remote-data-updates</code></h3>
<p>What is the difference between <code>sourcebit-target-next/hot-content-reload</code> and <code>sourcebit-target-next/with-remote-data-updates</code>.</p>
<p>The former is used in <code>create-stackbit-app</code>, while the latter is the form used by the docs. They both appear to do the same thing from a quick glance at the source.</p>
<p>The only reference to <code>hot-content-reload</code> is a brief mention in <a href="https://docs.stackbit.com/troubleshooting/page-doesnt-refresh/">the troubleshooting guide</a>.</p>
<p>It was not clear from the documentation which is the preferred method. Could we maybe merge these use cases? It seems confusing to me to have one method for git, and another for api (I'm assuming that was the intended difference between them).</p>
<hr>
<h3 id="2-annotations-usage-with-frontmatter"><a aria-hidden="true" class="anchor-heading" href="#2-annotations-usage-with-frontmatter"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>2. Annotations usage with frontmatter</h3>
<p>Why does <code>FlexiblePage</code> from <code>create-stackbit-app</code> not use <a href="https://docs.stackbit.com/reference/annotations/data-sb-field-path/#annotating_nested_objects">nested object notation</a> for fields defined in frontmatter? And how is it that when I flatten the frontmatter, the page still works without modification (IE. where specifically can I find the code that infers this automatically)? </p>
<pre class="language-tsx"><code class="language-tsx">    <span class="token comment">// console.log({ page, site });</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>page<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span><span class="token class-name">Head</span></span><span class="token punctuation">></span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>title</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>page<span class="token punctuation">.</span><span class="token property-access">frontmatter</span><span class="token punctuation">.</span><span class="token property-access">title</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>title</span><span class="token punctuation">></span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span><span class="token class-name">Head</span></span><span class="token punctuation">></span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span> <span class="token spread"><span class="token punctuation">{</span><span class="token spread operator">...</span><span class="token method function property-access">toObjectId</span><span class="token punctuation">(</span>page<span class="token punctuation">.</span><span class="token property-access">__metadata</span><span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
                </span><span class="token punctuation">{</span>page<span class="token punctuation">.</span><span class="token property-access">frontmatter</span><span class="token punctuation">.</span><span class="token property-access">sections</span> <span class="token operator">&#x26;&#x26;</span> <span class="token punctuation">(</span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span> <span class="token spread"><span class="token punctuation">{</span><span class="token spread operator">...</span><span class="token method function property-access">toFieldPath</span><span class="token punctuation">(</span><span class="token string">'sections'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
                        </span><span class="token punctuation">{</span>page<span class="token punctuation">.</span><span class="token property-access">frontmatter</span><span class="token punctuation">.</span><span class="token property-access">sections</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>section<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span><span class="token class-name">DynamicComponent</span></span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>index<span class="token punctuation">}</span></span> <span class="token spread"><span class="token punctuation">{</span><span class="token spread operator">...</span>section<span class="token punctuation">}</span></span> <span class="token spread"><span class="token punctuation">{</span><span class="token spread operator">...</span><span class="token method function property-access">toFieldPath</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>index<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
                        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
                    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span>
                <span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span><span class="token class-name">Footer</span></span> <span class="token spread"><span class="token punctuation">{</span><span class="token spread operator">...</span>site<span class="token punctuation">.</span><span class="token property-access">footer</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>According to the docs it should be <code>toFieldPath('frontmatter.sections')</code>, but this seems to not matter.</p>
<h4 id="21-contentful-source-breaks-local-dev"><a aria-hidden="true" class="anchor-heading" href="#21-contentful-source-breaks-local-dev"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>2.1 Contentful source breaks local dev</h4>
<p>And why does switching to the exact same model, but loaded from contentful, not work at all in stackbit local dev:</p>
<pre><code>error: AnnotationError: Field path starts with accessor (.) but parent field path not found (/html/body[1]/div[1]/div[1]/div[1]/div[1]/div[2]/div[1]/div[1]/a[1])
error: AnnotationError: Field path starts with accessor (.) but parent field path not found (/html/body[1]/div[1]/div[1]/div[1]/div[1]/div[2]/div[1]/div[1]/a[1]/h3[1])
error: AnnotationError: Field path starts with accessor (.) but parent field path not found (/html/body[1]/div[1]/div[1]/div[1]/div[1]/div[2]/div[1]/div[1]/a[1]/span[1])
error: AnnotationError: Field path starts with accessor (.) but parent field path not found (/html/body[1]/div[1]/div[1]/div[1]/div[1]/div[2]/div[1]/div[1]/a[2])
//...
</code></pre>
<p>See <a href="https://github.com/drkstr101/minimal-contentful-theme/pull/1/files">https://github.com/drkstr101/minimal-contentful-theme/pull/1/files</a> for a comparison of changes.</p>
<hr>
<h3 id="3-models-vs-contentmodels"><a aria-hidden="true" class="anchor-heading" href="#3-models-vs-contentmodels"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>3. <code>models</code> vs <code>contentModels</code></h3>
<p>What is the difference between the <code>contentModels</code> (documented) and <code>models</code> (undocumented) field in <code>stackbit.yaml</code></p>
<pre class="language-yml"><code class="language-yml"><span class="token key atrule">contentModels</span><span class="token punctuation">:</span>
  <span class="token key atrule">Page</span><span class="token punctuation">:</span>
    <span class="token key atrule">isPage</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">urlPath</span><span class="token punctuation">:</span> <span class="token string">"/{slug}"</span>
</code></pre>
<p>vs</p>
<pre class="language-yml"><code class="language-yml"><span class="token key atrule">models</span><span class="token punctuation">:</span>
    <span class="token key atrule">Page</span><span class="token punctuation">:</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> page
        <span class="token key atrule">urlPath</span><span class="token punctuation">:</span> <span class="token string">'/{slug}'</span>
</code></pre>
<p>The former only works with git, while the later only seems to work with api (EG contentful).</p>
<h3 id="4-stackbitcms-contentful"><a aria-hidden="true" class="anchor-heading" href="#4-stackbitcms-contentful"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>4. <code>@stackbit/cms-contentful</code></h3>
<p>I see this is added as a dependency to our existing contentful theme, but there is no mention in the docs about what this is or why/when it would be needed.</p>
<hr>
<h3 id="5-sourcebit-source-filesystem-improvements"><a aria-hidden="true" class="anchor-heading" href="#5-sourcebit-source-filesystem-improvements"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>5. <code>sourcebit-source-filesystem</code> improvements</h3>
<p>Would it be reasonable at this point to propose a breaking change to <code>sourcebit-source-filesystem</code> that flattens frontmatter by default (unless maybe specified in options), and also includes the resolved model name in <code>__metadata.modelName</code>? Automatically providing a <code>__metadata.urlPath</code> based on standard algo, perhaps configurable in options, would be another big win for code-reuse IMHO.</p>
<p><em>This would eliminate the need for magic fields polluting the domain model (IE <code>layout</code>, <code>type</code>, <code>slug</code>, etc.), and greatly improve code reuse across different model sources. Code resuse is pretty much impossible between sources as it stands now, without additional code to massage the data back into what one would expect for their own user-defined domain model.</em></p>
<hr>
<h3 id="6-data-dedupe-in-nextjs-cache"><a aria-hidden="true" class="anchor-heading" href="#6-data-dedupe-in-nextjs-cache"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>6. Data dedupe in nextjs cache</h3>
<p>Should we make an attempt to dedupe the page models from <code>sourcebit-target-nextjs</code>, which are currently listed both in the <code>objects</code> bucket and again in the <code>pages</code>? Or perhaps reference the page data by ID rather than copy all the fields? note: This only applies when <code>sourcebit-target-nextjs</code> has correctly defined its pages in the options.</p>
<p><em>This is not super important, but I could see it maybe having a small impact on performance for large(ish) sites. Although, it probably doesn't even matter since the only thing sent across the wire is that which is returned by <code>getStaticProps</code>...</em></p>
<hr>
<h3 id="7-sourcebit-deprecation"><a aria-hidden="true" class="anchor-heading" href="#7-sourcebit-deprecation"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>7. Sourcebit deprecation</h3>
<p>What gives with the ominous message in the docs that sourcebit will soon be deprecated? Would this be for the upcoming <code>contentlayer</code>, or is there something like a complete rewrite in the pipeline?</p>
<p>I hope my week long deep-dive into sourcebit was not in vain!</p>
<h2 id="references"><a aria-hidden="true" class="anchor-heading" href="#references"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>References</h2>
<ol>
<li><a href="https://www.notion.so/stackbit/Notes-adding-Contentful-to-existing-project-w-local-dev-WIP-173eab6a77d2403fa396c30f2cb2b8b0#f49ed497d33f491aa4913c8c908f597c">Notes: adding Contentful to existing project (w/local dev)</a> (I found many of these same issues had already been documented, but without any apparent resolution)</li>
<li><a href="https://github.com/drkstr101/minimal-contentful-theme/pull/1/files">Comparison of changes for contentful source</a></li>
</ol>